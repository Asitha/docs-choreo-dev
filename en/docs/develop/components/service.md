# Service Components

Service components are an essential building block in Choreo for developing cloud-native applications. They provide a simple and effective way of exposing functionality as a service to other components in the application or to the outside world.

## What is a service component?

A service component in Choreo is a component type that can be used to deploy and expose REST, GraphQL, or gRPC services. It is a fundamental building block for creating cloud-native applications in Choreo.

Service components can be used to encapsulate business logic and provide endpoints (standardized interfaces) for communication with other components or systems. They can be deployed and scaled independently, making them highly flexible and adaptable to changing workloads.

With the help of the service component, developers can quickly create APIs and microservices, making it easier to implement and manage complex software systems. Service components can also be integrated with other Choreo components, such as message processors, connectors, and data sources, to create powerful, end-to-end solutions.

## What are endpoints in service components?

Endpoints are a crucial concept in Choreo when developing services that need to be exposed to other services or applications. Services can expose multiple endpoints, each representing a unique entry point into the service. For example, a service may expose a REST API endpoint and a GraphQL endpoint, each providing different ways to interact with the service. Endpoints provide a way to define the specific network details for how a service can be accessed, such as the port number, protocol, and context path. By defining these details, endpoints make it possible for other services and applications to discover and interact with the service in a standardized way.

Endpoints in Choreo are defined by a combination of port binding, protocol, endpoint name, network visibility, endpoint schema and additional protocol-related fields. The following table provides details about each field

| Field | Description |
| ------- | ------- |
| name | A unique identifier for the endpoint within the service component. |
| port | The network port on which the endpoint is accessible. |
| protocol | The communication protocol used by the endpoint (e.g., HTTP, HTTPS, gRPC, etc.). |
| Network Visibility | The level of visibility granted to the endpoint. Determines the level of visibility granted to the endpoint, with the following options: <ul><li>Project: the endpoint can only be accessed by other components within the same project.</li><li>Organization: the endpoint can be accessed by any component within the same organization, but not by components outside of the organization.</li><li>Public: the endpoint can be accessed by any component, regardless of its location or organization.</li></ul> |
| Schema | Defines the structure and format of the data that is exchanged through the endpoint. |
| Context (HTTP and GraphQL only) | A path prefix that is added to the URL of the endpoint for routing purposes. |

## Configuring endpoints

When building a service component with the Dockerfile build-preset, you can configure the endpoint details using the endpoints.yaml configuration file. This file needs to be placed in the .choreo directory at the root of the build context path and committed to the source repository.

> **Note:** When building a service component with Ballerina build preset, the endpoint details are automatically detected by Choreo for REST API and GraphQL endpoints. You can override the autogenerated endpoint configuration by providing the endpoints.yaml file in the source directory

The endpoints.yaml file has a specific structure, and contains the following details:

- name: A unique name for the endpoint, which will be used when generating the managed API.
- port: The numeric port value that gets exposed via this endpoint.
- type: The type of traffic this endpoint is accepting, such as REST, GraphQL, or gRPC.
- visibility: The network level visibility of this endpoint, which defaults to "Project" if not specified. Accepted values are "Project", "Organization", or "Public".
- context: The context (base path) of the API that is exposed via this endpoint. This field is mandatory if the endpoint type is set to REST or GraphQL.
- schemaFilePath: The path to the schema definition file, which defaults to the wild card route if not provided. This field is only applicable to REST endpoint types and should be a relative path to the Docker context.

### Sample endpoints.yaml

File location:
```bash
<docker-build-context-path>/.choreo/endpoints.yaml
```

> NOTE: For components with Ballerina build preset `docker-build-context-path` should be replaced with `component-root`

File Content:
```yaml
# +required Version of the endpoint configuration YAML
version: 0.1

# +required List of endpoints to create
endpoints:
  # +required Unique name for the endpoint. (This name will be used when generating the managed API)
- name: Greeting 9090
  # +required Numeric port value that gets exposed via this endpoint
  port: 9090
  # +required Type of the traffic this endpoint is accepting. Examples: REST, GraphQL, etc.
  # Allowed values: REST, GraphQL, GRPC
  type: REST
  # +optional Network level visibility of this endpoint. Defaults to Project
  # Accepted values: Project|Organization|Public.
  visibility: Project
  # +optional Context (base path) of the API that is exposed via this endpoint.
  # This is mandatory if the endpoint type is set to REST or GraphQL.
  context: /greeting
  # +optional Path to the schema definition file. Defaults to wild card route if not provided
  # This is only applicable to REST endpoint types.
  # The path should be relative to the docker context.
  schemaFilePath: greeting_openapi.yaml
```

## Exposing endpoint as managed APIs

> NOTE: This feature is not available for gRPC endpoints.

Exposing endpoints as managed APIs is crucial to ensure secure and controlled access to the services being exposed. When a user wants to expose their written service to the outside world or the organization at large, there is an inherent security risk involved. To mitigate this risk, the Choreo platform is built with an internal (access within the organization only) or external (publicly accessible) gateway that is protected with Choreo API management making the services secure by design.

If you want to expose an endpoint as a managed API in Choreo, you need to set the network visibility to either Organization or Public. This allows the endpoint to be exposed through the Choreo API Gateway, which provides several benefits, including:

- Expose APIs to external and internal cosumers
- Full lifecycle API Management
- API throttling
- Secure APIs with industry standard authorization flows
- API analytics and monitoring

To expose an endpoint as a managed API, follow these steps:

1. Create a service component with the endpoint that you want to expose.
2. Set the network visibility of the endpoint to either Organization or the Public.
3. Deploy the service component by navigating to the deploy tab.
4. Go to manage then lifecycle section and select the endpoint from the drop-down
5. Publish the API
4. Configure the API management settings such as throttling, security policies and access controls as required using the usage plans, permissions, and settings tabs.

Once the service component is deployed, the endpoint will be exposed as a managed API through the Choreo API Gateway. You can then use the full lifecycle API management features provided by Choreo to test, deploy, and maintain your API, as well as monitor and manage it using the API management features.
